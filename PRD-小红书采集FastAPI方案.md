# PRD: å°çº¢ä¹¦ç¬”è®°é‡‡é›† FastAPI æœåŠ¡æ–¹æ¡ˆ

## æ–‡æ¡£ä¿¡æ¯

| é¡¹ç›®     | å†…å®¹                                    |
| -------- | --------------------------------------- |
| æ–‡æ¡£åç§° | å°çº¢ä¹¦ç¬”è®°é‡‡é›† FastAPI æœåŠ¡äº§å“éœ€æ±‚æ–‡æ¡£ |
| æ–‡æ¡£ç‰ˆæœ¬ | **v1.0**                                |
| åˆ›å»ºæ—¥æœŸ | 2026-01-06                              |
| æ›´æ–°æ—¥æœŸ | 2026-01-06                              |
| è´Ÿè´£äºº   | -                                       |
| çŠ¶æ€     | æ¨èæ–¹æ¡ˆ                                |

---

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯

å°çº¢ä¹¦ä½œä¸ºä¸»æµç¤¾äº¤åª’ä½“å¹³å°ï¼Œæ‹¥æœ‰å¤§é‡ä¼˜è´¨å†…å®¹åˆ›ä½œè€…ã€‚ä¸ºäº†è¿›è¡Œå†…å®¹åˆ†æã€æ•°æ®ç›‘æ§æˆ–è¥é”€ç ”ç©¶ï¼Œéœ€è¦é«˜æ•ˆåœ°é‡‡é›†åšä¸»çš„ç¬”è®°æ•°æ®å¹¶è¿›è¡Œç»“æ„åŒ–å­˜å‚¨ã€‚

æœ¬é¡¹ç›®é‡‡ç”¨ **FastAPI + Coze å·¥ä½œæµ** çš„æ··åˆæ¶æ„ï¼Œå°†å¤æ‚çš„é‡‡é›†é€»è¾‘å°è£…ä¸ºç‹¬ç«‹çš„ API æœåŠ¡ï¼Œç»“åˆ Coze å·¥ä½œæµè¿›è¡Œä»»åŠ¡ç¼–æ’ï¼Œå¹¶ç›´æ¥ä½¿ç”¨é£ä¹¦å®˜æ–¹ OpenAPI è¿›è¡Œæ•°æ®å†™å…¥ã€‚

### 1.2 æ¶æ„è®¾è®¡ç†å¿µ

**âœ¨ æ ¸å¿ƒåˆ›æ–°**ï¼šåŸºäºé£ä¹¦æ’ä»¶å¼€å‘æŒ‡å—ï¼Œé£ä¹¦å®˜æ–¹å·²æä¾›å®Œæ•´çš„å¤šç»´è¡¨æ ¼ OpenAPIï¼Œ**æˆ‘ä»¬æ— éœ€å®ç°ä¸­é—´å±‚å†™å…¥ API**ã€‚

**èŒè´£åˆ†ç¦»**ï¼š
1. **FastAPI æœåŠ¡** - ä¸“æ³¨äºé‡‡é›†å°çº¢ä¹¦ç¬”è®°æ•°æ®
2. **Coze å·¥ä½œæµ** - è´Ÿè´£ä»»åŠ¡ç¼–æ’å’Œæµç¨‹æ§åˆ¶
3. **é£ä¹¦å®˜æ–¹ API** - ç›´æ¥è´Ÿè´£æ•°æ®å†™å…¥

### 1.3 é¡¹ç›®ç›®æ ‡

**æ ¸å¿ƒç›®æ ‡**ï¼š
- æä¾›ç¨³å®šçš„å°çº¢ä¹¦ç¬”è®°é‡‡é›† API æœåŠ¡
- é€šè¿‡ Coze å·¥ä½œæµå®ç°çµæ´»çš„ä»»åŠ¡ç¼–æ’
- ç›´æ¥ä½¿ç”¨é£ä¹¦å®˜æ–¹ API è¿›è¡Œæ•°æ®å†™å…¥ï¼Œå‡å°‘ä¸­é—´å±‚
- æä¾›å¯é çš„é”™è¯¯å¤„ç†å’ŒçŠ¶æ€åé¦ˆ

**ä¸šåŠ¡ä»·å€¼**ï¼š
- èŒè´£æ¸…æ™°ï¼šé‡‡é›†ã€ç¼–æ’ã€å­˜å‚¨ä¸‰è€…è§£è€¦
- æ˜“äºæ‰©å±•ï¼šé‡‡é›† API å¯è¢«å…¶ä»–ç³»ç»Ÿå¤ç”¨
- ç»´æŠ¤ç®€å•ï¼šå†™å…¥é€»è¾‘ç”±é£ä¹¦å®˜æ–¹ç»´æŠ¤
- æ€§èƒ½ä¼˜åŒ–ï¼šå‡å°‘ä¸€å±‚ä¸­é—´è½¬å‘

### 1.4 é¡¹ç›®èŒƒå›´

**åŒ…å«**ï¼š
- **FastAPI é‡‡é›†æœåŠ¡**ï¼š
  - API Key éªŒè¯ï¼ˆæŸ¥è¯¢é£ä¹¦ç®¡ç†è¡¨æ ¼ï¼‰
  - å°çº¢ä¹¦ç¬”è®°æ•°æ®é‡‡é›†ï¼ˆ15 ä¸ªå­—æ®µï¼‰
  - è‡ªåŠ¨ç­¾åç”Ÿæˆï¼ˆä½¿ç”¨ xhshow åº“ï¼‰
  - è¿”å›é£ä¹¦è¡¨æ ¼æ ¼å¼æ•°æ®

- **Coze å·¥ä½œæµ**ï¼ˆ5 ä¸ªèŠ‚ç‚¹ï¼‰ï¼š
  - è°ƒç”¨é‡‡é›† API
  - æå–é£ä¹¦è¡¨æ ¼ä¿¡æ¯
  - è°ƒç”¨é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ API
  - ç»“æœæ±‡æ€»å’Œåé¦ˆ

**é‡‡é›†æ¡æ•°è§„åˆ™**ï¼š
- **é»˜è®¤é‡‡é›†èŒƒå›´**ï¼šåšä¸»ä¸»é¡µç¬¬ä¸€é¡µæ‰€æœ‰ç¬”è®°ï¼ˆå°çº¢ä¹¦é»˜è®¤è¿”å› 10-20 æ¡ï¼‰
- **é‡‡é›†é¡ºåº**ï¼šæŒ‰åšä¸»ä¸»é¡µæ˜¾ç¤ºé¡ºåºï¼ˆé€šå¸¸ä¸ºå‘å¸ƒæ—¶é—´å€’åºï¼‰
- **æ•°é‡æ§åˆ¶**ï¼šå¯é…ç½® `maxNotes` å‚æ•°ï¼ˆ1-50ï¼‰ï¼Œé»˜è®¤ 20 æ¡
- **æ€§èƒ½è€ƒè™‘**ï¼š
  - 16 æ¡ç¬”è®°çº¦éœ€ 90-170 ç§’ï¼ˆå«å»¶è¿Ÿä¿æŠ¤ï¼‰
  - 20 æ¡ç¬”è®°çº¦éœ€ 110-210 ç§’

**ä¸åŒ…å«**ï¼š
- ç¬”è®°è¯„è®ºæ•°æ®é‡‡é›†
- åˆ†é¡µé‡‡é›†ï¼ˆç¬¬ 2 é¡µåŠä»¥åï¼‰
- å†å²æ•°æ®å¢é‡æ›´æ–°
- ä¸­é—´å±‚å†™å…¥ APIï¼ˆç›´æ¥ä½¿ç”¨é£ä¹¦å®˜æ–¹ APIï¼‰

**æ ¸å¿ƒä¼˜åŠ¿**ï¼š
- âœ… **æ¶æ„ç®€å•æ¸…æ™°**ï¼šèŒè´£åˆ†ç¦»ï¼Œæ˜“äºç†è§£
- âœ… **ç»´æŠ¤æˆæœ¬ä½**ï¼šåªç»´æŠ¤é‡‡é›† APIï¼Œå†™å…¥ç”±é£ä¹¦å®˜æ–¹ç»´æŠ¤
- âœ… **æ‰©å±•æ€§å¼º**ï¼šé‡‡é›† API å¯è¢«å…¶ä»–ç³»ç»Ÿè°ƒç”¨
- âœ… **æ€§èƒ½æ›´å¥½**ï¼šå‡å°‘ä¸€å±‚ä¸­é—´è½¬å‘
- âœ… **å®Œå…¨è‡ªåŠ¨åŒ–**ï¼šæ— éœ€æ‰‹åŠ¨å¤åˆ¶ç­¾åå‚æ•°

---

## äºŒã€ç”¨æˆ·åœºæ™¯

### 2.1 ç›®æ ‡ç”¨æˆ·

**ä¸»è¦ç”¨æˆ·**ï¼š
- æ•°æ®åˆ†æå¸ˆï¼šéœ€è¦æ”¶é›†åšä¸»æ•°æ®è¿›è¡Œå†…å®¹åˆ†æ
- è¥é”€äººå‘˜ï¼šç›‘æ§ç«å“åšä¸»çš„å‘å¸ƒåŠ¨æ€
- ç ”ç©¶äººå‘˜ï¼šè¿›è¡Œç¤¾äº¤åª’ä½“å†…å®¹ç ”ç©¶
- å¼€å‘è€…ï¼šéœ€è¦é›†æˆå°çº¢ä¹¦æ•°æ®é‡‡é›†èƒ½åŠ›

### 2.2 ä½¿ç”¨åœºæ™¯

**åœºæ™¯ 1ï¼šç«å“åšä¸»ç›‘æ§**

> å°ç‹æ˜¯ä¸€åè¥é”€è¿è¥ï¼Œéœ€è¦æ¯å‘¨ç›‘æ§ 5 ä¸ªç«å“åšä¸»çš„å‘å¸ƒæƒ…å†µã€‚é€šè¿‡ Coze å·¥ä½œæµï¼Œä»–åªéœ€è¾“å…¥åšä¸»ä¸»é¡µé“¾æ¥å’Œ Cookieï¼Œåå° FastAPI æœåŠ¡è‡ªåŠ¨é‡‡é›†æœ€æ–°ç¬”è®°æ•°æ®ï¼Œå¹¶é€šè¿‡é£ä¹¦å®˜æ–¹ API å†™å…¥è¡¨æ ¼ï¼Œç”¨äºå‘¨æŠ¥åˆ†æã€‚

**åœºæ™¯ 2ï¼šæ•°æ®åˆ†æå¹³å°é›†æˆ**

> æŸæ•°æ®åˆ†æå¹³å°éœ€è¦é›†æˆå°çº¢ä¹¦æ•°æ®é‡‡é›†åŠŸèƒ½ã€‚ä»–ä»¬ç›´æ¥è°ƒç”¨ FastAPI é‡‡é›† APIï¼Œè·å–ç»“æ„åŒ–çš„ç¬”è®°æ•°æ®åï¼Œå­˜å‚¨åˆ°è‡ªå·±çš„æ•°æ®åº“ä¸­è¿›è¡Œæ·±åº¦åˆ†æã€‚

**åœºæ™¯ 3ï¼šè‡ªåŠ¨åŒ–æ•°æ®é‡‡é›†**

> å“ç‰Œæ–¹éœ€è¦å®šæ—¶é‡‡é›†å…³æ³¨çš„åšä¸»æ•°æ®ã€‚é€šè¿‡ Coze å·¥ä½œæµçš„å®šæ—¶è§¦å‘åŠŸèƒ½ï¼Œæ¯å¤©è‡ªåŠ¨è°ƒç”¨ FastAPI é‡‡é›† APIï¼Œè·å–æœ€æ–°ç¬”è®°å¹¶å†™å…¥é£ä¹¦è¡¨æ ¼ï¼Œæ— éœ€äººå·¥å¹²é¢„ã€‚

---

## ä¸‰ã€ç³»ç»Ÿæ¶æ„

### 3.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Coze å·¥ä½œæµ (5 ä¸ªèŠ‚ç‚¹)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚  å¼€å§‹èŠ‚ç‚¹    â”‚  è¾“å…¥: apiKey, cookie, bozhulianjie,      â”‚
â”‚  â”‚(å‚æ•°è¾“å…¥)    â”‚       biaogelianjie, maxNotes             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚         â”‚                                                     â”‚
â”‚         â†“                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚ HTTP è¯·æ±‚èŠ‚ç‚¹ 1      â”‚  è°ƒç”¨ FastAPI é‡‡é›† API             â”‚
â”‚  â”‚ POST /api/v1/collect â”‚  è¿”å›: records (é£ä¹¦æ ¼å¼)          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚             â”‚                                                 â”‚
â”‚             â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”‚
â”‚  â”‚   ä»£ç èŠ‚ç‚¹           â”‚  ä» biaogelianjie æå–            â”‚
â”‚  â”‚ æå–è¡¨æ ¼ä¿¡æ¯         â”‚  appToken å’Œ tableId              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â”‚
â”‚             â”‚                                                 â”‚
â”‚             â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚  â”‚ HTTP è¯·æ±‚èŠ‚ç‚¹ 2              â”‚  è°ƒç”¨é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ API  â”‚
â”‚  â”‚ é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ API         â”‚  ç›´æ¥å†™å…¥å¤šç»´è¡¨æ ¼          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚             â”‚                                                 â”‚
â”‚             â†“                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚
â”‚  â”‚  ç»“æŸèŠ‚ç‚¹    â”‚  è¿”å›: é‡‡é›†+å†™å…¥æ±‡æ€»ç»“æœ                   â”‚
â”‚  â”‚(è¾“å‡ºçŠ¶æ€)    â”‚                                            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ HTTP POST
                          â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     FastAPI é‡‡é›†æœåŠ¡ (æœåŠ¡å™¨)       â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                                     â”‚
          â”‚  POST /api/v1/collect               â”‚
          â”‚    â†“                                â”‚
          â”‚  1. éªŒè¯ API Key                    â”‚
          â”‚  2. é‡‡é›†å°çº¢ä¹¦ç¬”è®°                  â”‚
          â”‚  3. ç”Ÿæˆç­¾å (xhshow)               â”‚
          â”‚  4. è¯·æ±‚å°çº¢ä¹¦ API                  â”‚
          â”‚  5. å¤„ç†æ•°æ® â†’ é£ä¹¦æ ¼å¼             â”‚
          â”‚    â†“                                â”‚
          â”‚  è¿”å› records æ•°ç»„                  â”‚
          â”‚                                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ è¿”å›æ•°æ®
                          â†“
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ API (å®˜æ–¹æœåŠ¡)   â”‚
          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
          â”‚                                     â”‚
          â”‚  POST /open-apis/bitable/v1/apps/  â”‚
          â”‚      {app_token}/tables/            â”‚
          â”‚      {table_id}/records/            â”‚
          â”‚      batch_create                   â”‚
          â”‚                                     â”‚
          â”‚  åŸŸå: base-api.feishu.cn           â”‚
          â”‚  è®¤è¯: PersonalBaseToken            â”‚
          â”‚                                     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ¶æ„ä¼˜åŠ¿å¯¹æ¯”

| å¯¹æ¯”é¡¹                | ä¸­é—´å±‚æ–¹æ¡ˆ           | FastAPI + é£ä¹¦å®˜æ–¹ API (æœ¬æ–¹æ¡ˆ) |
| --------------------- | -------------------- | ------------------------------- |
| **éœ€è¦å®ç°çš„ API**    | 2 ä¸ªï¼ˆé‡‡é›† + å†™å…¥ï¼‰  | 1 ä¸ªï¼ˆä»…é‡‡é›†ï¼‰                  |
| **æœåŠ¡å™¨ä»£ç å¤æ‚åº¦**  | é«˜                   | ä½                              |
| **ç»´æŠ¤æˆæœ¬**          | é«˜ï¼ˆéœ€ç»´æŠ¤ä¸¤ä¸ª APIï¼‰ | ä½ï¼ˆåªç»´æŠ¤é‡‡é›† APIï¼‰            |
| **é£ä¹¦ API å˜æ›´å½±å“** | éœ€æ›´æ–°ä¸­é—´å±‚ä»£ç      | æ— å½±å“ï¼ˆç›´æ¥è°ƒç”¨å®˜æ–¹ï¼‰          |
| **è°ƒè¯•éš¾åº¦**          | ä¸­ï¼ˆéœ€è°ƒè¯•ä¸­é—´å±‚ï¼‰   | ä½ï¼ˆå®˜æ–¹ API ç¨³å®šï¼‰             |
| **æ€§èƒ½**              | å¤šä¸€å±‚è½¬å‘           | ç›´æ¥è°ƒç”¨ï¼Œæ›´å¿«                  |
| **æ‰©å±•æ€§**            | ä¸­                   | é«˜ï¼ˆé‡‡é›† API å¯ç‹¬ç«‹å¤ç”¨ï¼‰       |

---

## å››ã€åŠŸèƒ½éœ€æ±‚

### 4.1 FastAPI é‡‡é›† API

#### ç«¯ç‚¹: `POST /api/v1/collect`

**èŒè´£**ï¼š
- éªŒè¯ API Keyï¼ˆæŸ¥è¯¢é£ä¹¦ API Key ç®¡ç†è¡¨æ ¼ï¼‰
- é‡‡é›†å°çº¢ä¹¦åšä¸»ç¬”è®°æ•°æ®
- è¿”å›é£ä¹¦è¡¨æ ¼æ ¼å¼çš„è®°å½•ï¼ˆä¸å†™å…¥ï¼‰

**è¯·æ±‚å‚æ•°** (CollectRequest):

| å‚æ•°å       | ç±»å‹    | å¿…å¡«  | é»˜è®¤å€¼  | è¯´æ˜                  | ç¤ºä¾‹                                           |
| ------------ | ------- | :---: | ------- | --------------------- | ---------------------------------------------- |
| apiKey       | String  |   âœ“   | -       | API Keyï¼Œç”¨äºæƒé™éªŒè¯ | `P2025685459865471`                            |
| cookie       | String  |   âœ“   | -       | å°çº¢ä¹¦ Cookie         | `a1=xxx; web_session=xxx; ...`                 |
| bozhulianjie | String  |   âœ“   | -       | åšä¸»ä¸»é¡µé“¾æ¥          | `https://www.xiaohongshu.com/user/profile/xxx` |
| maxNotes     | Integer |   âœ—   | 20      | æœ€å¤§é‡‡é›†æ•°é‡ï¼ˆ1-50ï¼‰  | `20`                                           |
| userAgent    | String  |   âœ—   | é»˜è®¤ UA | è‡ªå®šä¹‰ User-Agent     | `Mozilla/5.0 ...`                              |

**è¯·æ±‚ç¤ºä¾‹**:
```json
{
  "apiKey": "P2025685459865471",
  "cookie": "a1=xxx; web_session=xxx; ...",
  "bozhulianjie": "https://www.xiaohongshu.com/user/profile/66b4c79d000000001d031033",
  "maxNotes": 20,
  "userAgent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
}
```

**å“åº”å‚æ•°** (CollectResponse):

| å­—æ®µå        | ç±»å‹                | è¯´æ˜                               | ç¤ºä¾‹                   |
| ------------- | ------------------- | ---------------------------------- | ---------------------- |
| success       | Boolean             | æ˜¯å¦æˆåŠŸ                           | `true`                 |
| code          | Integer             | çŠ¶æ€ç ï¼ˆ0=æˆåŠŸï¼Œ401/403/500=å¤±è´¥ï¼‰ | `0`                    |
| message       | String              | æ¶ˆæ¯                               | `"æˆåŠŸé‡‡é›† 16 æ¡ç¬”è®°"` |
| totalCount    | Integer             | æ€»ç¬”è®°æ•°é‡                         | `16`                   |
| successCount  | Integer             | æˆåŠŸé‡‡é›†æ•°é‡                       | `16`                   |
| failedCount   | Integer             | å¤±è´¥æ•°é‡                           | `0`                    |
| failedNoteIds | Array\<String\>     | å¤±è´¥çš„ç¬”è®° ID åˆ—è¡¨                 | `[]`                   |
| records       | Array\<NoteRecord\> | ç¬”è®°è®°å½•æ•°ç»„ï¼ˆé£ä¹¦æ ¼å¼ï¼‰           | è§ä¸‹æ–¹                 |

**records æ•°æ®ç»“æ„**:
```json
{
  "records": [
    {
      "fields": {
        "å›¾ç‰‡é“¾æ¥": "http://sns-webpic...\nhttp://sns-webpic...",
        "ç¬”è®°æ ‡é¢˜": "ç‹¬å¤„Plogï½œ...",
        "ç¬”è®°å†…å®¹": "ä»Šå¤©çš„æ™šä¸Š...",
        "ç¬”è®°ç±»å‹": "normal",
        "ç¬”è®°é“¾æ¥": "https://www.xiaohongshu.com/explore/xxx",
        "ç¬”è®°æ ‡ç­¾": ["ç¾é£Ÿ", "vlog"],
        "è´¦å·åç§°": "é±¼å·²å·²",
        "ä¸»é¡µé“¾æ¥": "https://www.xiaohongshu.com/user/profile/xxx",
        "å¤´åƒé“¾æ¥": "https://sns-avatar...",
        "åˆ†äº«æ•°": 120,
        "ç‚¹èµæ•°": 63,
        "æ”¶è—æ•°": 89,
        "è¯„è®ºæ•°": 45,
        "è§†é¢‘é“¾æ¥": "",
        "å‘å¸ƒæ—¶é—´": 1766917745000
      }
    }
  ]
}
```

**é”™è¯¯å“åº”**:

| HTTP çŠ¶æ€ç  | code | è¯´æ˜                  | message ç¤ºä¾‹                  |
| ----------- | ---- | --------------------- | ----------------------------- |
| 401         | 401  | API Key æ— æ•ˆ/ä¸å­˜åœ¨   | `"API Key ä¸å­˜åœ¨"`            |
| 403         | 403  | API Key å·²è¿‡æœŸ/å·²å†»ç»“ | `"API Key å·²è¿‡æœŸ"`            |
| 400         | 400  | Cookie å¤±æ•ˆ           | `"Cookie å·²å¤±æ•ˆï¼Œè¯·é‡æ–°è·å–"` |
| 500         | 500  | ç³»ç»Ÿé”™è¯¯              | `"ç³»ç»Ÿé”™è¯¯: xxx"`             |

### 4.2 é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ APIï¼ˆæ— éœ€å®ç°ï¼‰

**åŸŸå**: `https://base-api.feishu.cn`

**ç«¯ç‚¹**: `POST /open-apis/bitable/v1/apps/{app_token}/tables/{table_id}/records/batch_create`

**æ–‡æ¡£**: https://open.feishu.cn/document/server-docs/docs/bitable-v1/app-table-record/batch_create

**è¯·æ±‚å¤´**:
```http
Authorization: Bearer {PersonalBaseToken}
Content-Type: application/json
```

**è¯·æ±‚ä½“**:
```json
{
  "records": [
    {
      "fields": {
        "ç¬”è®°æ ‡é¢˜": "...",
        "ç‚¹èµæ•°": 123,
        ...
      }
    }
  ]
}
```

**å“åº”**:
```json
{
  "code": 0,
  "msg": "success",
  "data": {
    "records": [
      {
        "record_id": "recxxxxxx",
        "fields": {...}
      }
    ]
  }
}
```

**PersonalBaseToken è·å–æ–¹å¼**:
1. æ‰“å¼€é£ä¹¦å¤šç»´è¡¨æ ¼
2. ç‚¹å‡»å³ä¸Šè§’"..."èœå•
3. é€‰æ‹©"é«˜çº§è®¾ç½®" â†’ "ä¸ªäººè®¿é—®ä»¤ç‰Œ"
4. å¤åˆ¶ Tokenï¼ˆé»˜è®¤æ°¸ä¹…æœ‰æ•ˆï¼‰

### 4.3 Coze å·¥ä½œæµé…ç½®

#### èŠ‚ç‚¹ 1: å¼€å§‹èŠ‚ç‚¹

**è¾“å…¥å‚æ•°**:
```json
{
  "apiKey": "string",
  "cookie": "string",
  "bozhulianjie": "string",
  "biaogelianjie": "string",
  "maxNotes": 20,
  "personalBaseToken": "string"
}
```

#### èŠ‚ç‚¹ 2: HTTP è¯·æ±‚ - é‡‡é›† API

**URL**: `https://your-server.com/api/v1/collect`

**Method**: POST

**Headers**:
```json
{
  "Content-Type": "application/json"
}
```

**Body**:
```json
{
  "apiKey": "{{å¼€å§‹èŠ‚ç‚¹.apiKey}}",
  "cookie": "{{å¼€å§‹èŠ‚ç‚¹.cookie}}",
  "bozhulianjie": "{{å¼€å§‹èŠ‚ç‚¹.bozhulianjie}}",
  "maxNotes": {{å¼€å§‹èŠ‚ç‚¹.maxNotes}}
}
```

**è¾“å‡ºå˜é‡**:
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹1.success}}`
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹1.records}}` - ä¼ ç»™é£ä¹¦ API
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹1.totalCount}}`

#### èŠ‚ç‚¹ 3: ä»£ç èŠ‚ç‚¹ - æå–è¡¨æ ¼ä¿¡æ¯

**è¾“å…¥**: `{{å¼€å§‹èŠ‚ç‚¹.biaogelianjie}}`

**ä»£ç ** (JavaScript):
```javascript
async function main({ params }) {
  const url = params.biaogelianjie;

  // æå– app_token: base/åé¢çš„éƒ¨åˆ†
  const appTokenMatch = url.match(/base\/([^?]+)/);
  const appToken = appTokenMatch ? appTokenMatch[1] : null;

  // æå– table_id: table=åé¢çš„éƒ¨åˆ†
  const tableIdMatch = url.match(/table=([^&]+)/);
  const tableId = tableIdMatch ? tableIdMatch[1] : null;

  if (!appToken || !tableId) {
    throw new Error("æ— æ³•ä»é“¾æ¥ä¸­æå– appToken æˆ– tableId");
  }

  return {
    appToken,
    tableId
  };
}
```

**è¾“å‡ºå˜é‡**:
- `{{ä»£ç èŠ‚ç‚¹.appToken}}`
- `{{ä»£ç èŠ‚ç‚¹.tableId}}`

#### èŠ‚ç‚¹ 4: HTTP è¯·æ±‚ - é£ä¹¦å®˜æ–¹æ‰¹é‡å†™å…¥ API

**URL**:
```
https://base-api.feishu.cn/open-apis/bitable/v1/apps/{{ä»£ç èŠ‚ç‚¹.appToken}}/tables/{{ä»£ç èŠ‚ç‚¹.tableId}}/records/batch_create
```

**Method**: POST

**Headers**:
```json
{
  "Authorization": "Bearer {{å¼€å§‹èŠ‚ç‚¹.personalBaseToken}}",
  "Content-Type": "application/json"
}
```

**Body**:
```json
{
  "records": "{{HTTPè¯·æ±‚èŠ‚ç‚¹1.records}}"
}
```

**è¾“å‡ºå˜é‡**:
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹2.code}}` - 0 è¡¨ç¤ºæˆåŠŸ
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹2.msg}}`
- `{{HTTPè¯·æ±‚èŠ‚ç‚¹2.data.records}}`

#### èŠ‚ç‚¹ 5: ç»“æŸèŠ‚ç‚¹

**è¾“å‡º**:
```json
{
  "collectSuccess": "{{HTTPè¯·æ±‚èŠ‚ç‚¹1.success}}",
  "collectCount": "{{HTTPè¯·æ±‚èŠ‚ç‚¹1.totalCount}}",
  "writeSuccess": "{{HTTPè¯·æ±‚èŠ‚ç‚¹2.code}} == 0",
  "writeRecordCount": "{{HTTPè¯·æ±‚èŠ‚ç‚¹2.data.records.length}}",
  "message": "é‡‡é›†å¹¶å†™å…¥å®Œæˆ"
}
```

---

## äº”ã€æ•°æ®å­—å…¸

### 5.1 é£ä¹¦è¡¨æ ¼å­—æ®µï¼ˆ15 ä¸ªå­—æ®µï¼‰

| åºå·  | å­—æ®µåç§° | å­—æ®µç±»å‹ | æ˜¯å¦å¿…å¡« | æ•°æ®æ¥æº | è¯´æ˜                 | ç¤ºä¾‹                   |
| :---: | -------- | -------- | :------: | -------- | -------------------- | ---------------------- |
|   1   | å›¾ç‰‡é“¾æ¥ | æ–‡æœ¬     |    âœ—     | feed API | å¤šå¼ å›¾ç‰‡ç”¨æ¢è¡Œç¬¦åˆ†éš” | `http://sns-webpic...` |
|   2   | ç¬”è®°æ ‡é¢˜ | æ–‡æœ¬     |    âœ“     | feed API | ç¬”è®°çš„å®Œæ•´æ ‡é¢˜       | `ç‹¬å¤„Plogï½œ...ğŸŒƒ`       |
|   3   | ç¬”è®°å†…å®¹ | æ–‡æœ¬     |    âœ“     | feed API | ç¬”è®°æ­£æ–‡å†…å®¹         | `ä»Šå¤©çš„æ™šä¸Š...`        |
|   4   | ç¬”è®°ç±»å‹ | æ–‡æœ¬     |    âœ“     | feed API | ç¬”è®°å†…å®¹ç±»å‹         | `normal` / `video`     |
|   5   | ç¬”è®°é“¾æ¥ | æ–‡æœ¬     |    âœ“     | æ„é€      | å¯ç›´æ¥è®¿é—®çš„ç¬”è®°é“¾æ¥ | `https://www...`       |
|   6   | ç¬”è®°æ ‡ç­¾ | å¤šé€‰     |    âœ—     | feed API | è¯é¢˜æ ‡ç­¾æ•°ç»„         | `["ç¾é£Ÿ", "vlog"]`     |
|   7   | è´¦å·åç§° | å•é€‰     |    âœ“     | feed API | åšä¸»æ˜µç§°             | `é±¼å·²å·²`               |
|   8   | ä¸»é¡µé“¾æ¥ | æ–‡æœ¬     |    âœ“     | æ„é€      | åšä¸»ä¸»é¡µé“¾æ¥         | `https://www...`       |
|   9   | å¤´åƒé“¾æ¥ | æ–‡æœ¬     |    âœ—     | feed API | åšä¸»å¤´åƒå›¾ç‰‡ URL     | `https://sns...`       |
|  10   | åˆ†äº«æ•°   | æ•°å­—     |    âœ“     | feed API | åˆ†äº«æ¬¡æ•°             | `120`                  |
|  11   | ç‚¹èµæ•°   | æ•°å­—     |    âœ“     | feed API | ç‚¹èµæ•°é‡             | `63`                   |
|  12   | æ”¶è—æ•°   | æ•°å­—     |    âœ“     | feed API | æ”¶è—æ•°é‡             | `89`                   |
|  13   | è¯„è®ºæ•°   | æ•°å­—     |    âœ“     | feed API | è¯„è®ºæ•°é‡             | `45`                   |
|  14   | è§†é¢‘é“¾æ¥ | æ–‡æœ¬     |    âœ—     | feed API | è§†é¢‘ URL             | `http://sns-video...`  |
|  15   | å‘å¸ƒæ—¶é—´ | æ—¥æœŸ     |    âœ“     | feed API | å‘å¸ƒæ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰   | `1766917745000`        |

**âš ï¸ å­—æ®µç±»å‹ç‰¹åˆ«æ³¨æ„**ï¼š

1. **å¤šé€‰å­—æ®µ**ï¼ˆç¬”è®°æ ‡ç­¾ï¼‰ï¼š
   - âœ… å¿…é¡»è¿”å›**æ•°ç»„**ï¼š`["æ ‡ç­¾1", "æ ‡ç­¾2"]`
   - âŒ ä¸èƒ½è¿”å›å­—ç¬¦ä¸²ï¼š`"æ ‡ç­¾1,æ ‡ç­¾2"`
   - ç¤ºä¾‹ï¼š`ç¬”è®°æ ‡ç­¾: ["è…Šè‚ çŠ¬", "å¸¦ç‹—ä½é…’åº—"]`

2. **æ•°å­—å­—æ®µ**ï¼ˆåˆ†äº«æ•°ã€ç‚¹èµæ•°ã€æ”¶è—æ•°ã€è¯„è®ºæ•°ï¼‰ï¼š
   - âœ… å¿…é¡»è¿”å› **number ç±»å‹**
   - ä½¿ç”¨ `parseInt()` æˆ– `parseFloat()` è½¬æ¢
   - ç¤ºä¾‹ï¼š`ç‚¹èµæ•°: 123` ï¼ˆä¸æ˜¯ `"123"`ï¼‰

3. **æ—¥æœŸå­—æ®µ**ï¼ˆå‘å¸ƒæ—¶é—´ï¼‰ï¼š
   - âœ… å¿…é¡»è¿”å›**æ¯«ç§’æ—¶é—´æˆ³**ï¼ˆnumber ç±»å‹ï¼‰
   - ç¤ºä¾‹ï¼š`å‘å¸ƒæ—¶é—´: 1766917745000`

### 5.2 å­—æ®µæ˜ å°„å…³ç³»

| é£ä¹¦å­—æ®µ | å°çº¢ä¹¦ feed API è·¯å¾„                        | è½¬æ¢è§„åˆ™                                                   |
| -------- | ------------------------------------------- | ---------------------------------------------------------- |
| å›¾ç‰‡é“¾æ¥ | `image_list[].url_default`                  | å¤šå¼ å›¾ç‰‡ç”¨ `\n` è¿æ¥                                       |
| ç¬”è®°æ ‡é¢˜ | `note_card.title`                           | ç›´æ¥æ˜ å°„                                                   |
| ç¬”è®°å†…å®¹ | `note_card.desc`                            | ç›´æ¥æ˜ å°„ï¼Œå»é™¤è¯é¢˜æ ‡ç­¾                                     |
| ç¬”è®°ç±»å‹ | `note_card.type`                            | ç›´æ¥æ˜ å°„                                                   |
| ç¬”è®°é“¾æ¥ | -                                           | æ„é€ ï¼š`https://www.xiaohongshu.com/explore/{note_id}`      |
| ç¬”è®°æ ‡ç­¾ | `note_card.desc`                            | æå– `#xxx[è¯é¢˜]` å¹¶è½¬ä¸ºæ•°ç»„                               |
| è´¦å·åç§° | `note_card.user.nickname`                   | ç›´æ¥æ˜ å°„                                                   |
| ä¸»é¡µé“¾æ¥ | -                                           | æ„é€ ï¼š`https://www.xiaohongshu.com/user/profile/{user_id}` |
| å¤´åƒé“¾æ¥ | `note_card.user.avatar`                     | ç›´æ¥æ˜ å°„                                                   |
| åˆ†äº«æ•°   | `note_card.interact_info.share_count`       | `parseInt()` è½¬æ•°å­—                                        |
| ç‚¹èµæ•°   | `note_card.interact_info.liked_count`       | `parseInt()` è½¬æ•°å­—                                        |
| æ”¶è—æ•°   | `note_card.interact_info.collected_count`   | `parseInt()` è½¬æ•°å­—                                        |
| è¯„è®ºæ•°   | `note_card.interact_info.comment_count`     | `parseInt()` è½¬æ•°å­—                                        |
| è§†é¢‘é“¾æ¥ | `note_card.video.consumer.origin_video_key` | è½¬ URL æˆ–ç©ºå­—ç¬¦ä¸²                                          |
| å‘å¸ƒæ—¶é—´ | `note_card.time`                            | æ¯«ç§’æ—¶é—´æˆ³                                                 |

---

## å…­ã€æŠ€æœ¯å®ç°

### 6.1 æŠ€æœ¯æ ˆ

**FastAPI æœåŠ¡**:
- ç¼–ç¨‹è¯­è¨€ï¼šPython 3.11+
- Web æ¡†æ¶ï¼šFastAPI
- ä¾èµ–åº“ï¼š
  - `xhshow`ï¼šå°çº¢ä¹¦ç­¾åç”Ÿæˆ
  - `httpx`ï¼šå¼‚æ­¥ HTTP è¯·æ±‚
  - `pydantic`ï¼šæ•°æ®æ¨¡å‹éªŒè¯
  - `python-dotenv`ï¼šç¯å¢ƒå˜é‡ç®¡ç†

**Coze å·¥ä½œæµ**:
- å¹³å°ï¼šCoze å·¥ä½œæµå¹³å°
- èŠ‚ç‚¹ç±»å‹ï¼šå¼€å§‹èŠ‚ç‚¹ã€HTTP è¯·æ±‚èŠ‚ç‚¹ã€ä»£ç èŠ‚ç‚¹ã€ç»“æŸèŠ‚ç‚¹

**æ•°æ®å­˜å‚¨**:
- é£ä¹¦å¤šç»´è¡¨æ ¼ï¼ˆBitableï¼‰

### 6.2 æ ¸å¿ƒæ¨¡å—

#### 6.2.1 API Key éªŒè¯

**æ–‡ä»¶**: `app/services/apikey_validator.py`

**åŠŸèƒ½**ï¼šæŸ¥è¯¢é£ä¹¦ API Key ç®¡ç†è¡¨æ ¼ï¼ŒéªŒè¯ Key çš„æœ‰æ•ˆæ€§

**éªŒè¯é€»è¾‘**ï¼š
1. è·å–é£ä¹¦è®¿é—®ä»¤ç‰Œ
2. æŸ¥è¯¢ API Key è®°å½•
3. æ£€æŸ¥çŠ¶æ€ï¼š
   - âœ… æœªæ¿€æ´»/å·²æ¿€æ´» â†’ é€šè¿‡
   - âŒ å·²è¿‡æœŸ/å·²å†»ç»“ â†’ æ‹’ç»
4. æ›´æ–°ä½¿ç”¨ä¿¡æ¯ï¼ˆä½¿ç”¨æ¬¡æ•°+1ã€æœ€åä½¿ç”¨æ—¶é—´ï¼‰
5. é¦–æ¬¡ä½¿ç”¨æ—¶è‡ªåŠ¨æ¿€æ´»

#### 6.2.2 å°çº¢ä¹¦æ•°æ®é‡‡é›†

**æ–‡ä»¶**: `app/services/xhs_collector.py`

**ä¸»è¦æ–¹æ³•**ï¼š

1. **`fetch_notes_via_api()`** - è·å–ç¬”è®°åˆ—è¡¨
   - è°ƒç”¨ï¼š`edith.xiaohongshu.com/api/sns/web/v1/user_posted`
   - è¿”å›ï¼š`List[NoteInfo]`

2. **`fetch_note_detail()`** - è·å–å•æ¡ç¬”è®°è¯¦æƒ…
   - è°ƒç”¨ï¼š`edith.xiaohongshu.com/api/sns/web/v1/feed`
   - è¿”å›ï¼šåŸå§‹ feed API å“åº”

3. **`process_note_detail()`** - è½¬æ¢ä¸ºé£ä¹¦æ ¼å¼
   - è¾“å…¥ï¼šfeed_data
   - è¾“å‡ºï¼š`NoteRecord`ï¼ˆåŒ…å« fields å­—å…¸ï¼‰

4. **`collect_all_notes()`** - ä¸»æµç¨‹
   - è·å–ç¬”è®°åˆ—è¡¨ â†’ é€æ¡è·å–è¯¦æƒ… â†’ é€æ¡å¤„ç†æ ¼å¼
   - è¿”å›ï¼š`(records, success_count, fail_count, failed_note_ids)`

#### 6.2.3 ç­¾åç”Ÿæˆ

**æ–‡ä»¶**: `app/services/xhs_sign.py`

**åŠŸèƒ½**ï¼šä½¿ç”¨ xhshow åº“ç”Ÿæˆå°çº¢ä¹¦ API è¯·æ±‚ç­¾å

**å…³é”®æ–¹æ³•**ï¼š
- `sign_headers_get(url, params, cookie)` - GET è¯·æ±‚ç­¾å
- `sign_headers_post(url, data, cookie)` - POST è¯·æ±‚ç­¾å

**è¿”å›**ï¼š`{"x-s": "...", "x-s-common": "...", "x-t": "..."}`

### 6.3 å»¶è¿Ÿä¿æŠ¤ç­–ç•¥

**ç›®çš„**ï¼šé¿å…è§¦å‘å°çº¢ä¹¦åçˆ¬è™«æœºåˆ¶

**ä¸»é¡µè¯·æ±‚å»¶è¿Ÿ**ï¼š0.5-2 ç§’ï¼ˆéšæœºï¼‰

**ç¬”è®°è¯¦æƒ…è¯·æ±‚å»¶è¿Ÿ**ï¼ˆæ™ºèƒ½æ¸è¿›å¼ï¼‰ï¼š
- å‰ 5 æ¡ç¬”è®°ï¼š3-5 ç§’
- ç¬¬ 6-10 æ¡ï¼š4-6 ç§’
- ç¬¬ 11+ æ¡ï¼š5-8 ç§’

### 6.4 é”™è¯¯å¤„ç†

| é”™è¯¯ç±»å‹         | æ£€æµ‹æ–¹å¼              | å¤„ç†æ–¹å¼   | è¿”å›ä¿¡æ¯                                |
| ---------------- | --------------------- | ---------- | --------------------------------------- |
| API Key éªŒè¯å¤±è´¥ | é£ä¹¦è¡¨æ ¼æŸ¥è¯¢          | ç«‹å³ç»ˆæ­¢   | `{ error: "API Key æ— æ•ˆ", code: 401 }`  |
| Cookie å¤±æ•ˆ      | `status_code == 401`  | è¿”å›é”™è¯¯   | `{ error: "Cookie å·²å¤±æ•ˆ", code: 400 }` |
| è¯·æ±‚é™æµ         | `status_code == 429`  | è¿”å›é”™è¯¯   | `{ error: "è¯·æ±‚è¿‡å¿«", code: 429 }`      |
| ç½‘ç»œå¼‚å¸¸         | `requests.exceptions` | æ•è·å¹¶è¿”å› | `{ error: "ç½‘ç»œé”™è¯¯: xxx", code: 500 }` |

---

## ä¸ƒã€éƒ¨ç½²æ–¹æ¡ˆ

### 7.1 æœåŠ¡å™¨ç¯å¢ƒ

**æ¨èé…ç½®**ï¼š
- CPUï¼š2 æ ¸
- å†…å­˜ï¼š4GB
- æ“ä½œç³»ç»Ÿï¼šUbuntu 20.04 LTS
- Pythonï¼š3.11+

### 7.2 éƒ¨ç½²æ–¹å¼

#### æ–¹å¼ 1: Docker éƒ¨ç½²ï¼ˆæ¨èï¼‰

**Dockerfile**:
```dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt
COPY . .
CMD ["uvicorn", "app.main:app", "--host", "0.0.0.0", "--port", "8000"]
```

**éƒ¨ç½²å‘½ä»¤**:
```bash
docker build -t xhs-collector .
docker run -d -p 8000:8000 --env-file .env xhs-collector
```

#### æ–¹å¼ 2: äº‘æœåŠ¡å™¨ç›´æ¥éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp env_example.txt .env
# ç¼–è¾‘ .env æ–‡ä»¶

# 3. å¯åŠ¨æœåŠ¡ï¼ˆä½¿ç”¨ systemd æˆ– supervisorï¼‰
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

### 7.3 ç¯å¢ƒå˜é‡é…ç½®

**å¿…éœ€é…ç½®**:
```bash
# é£ä¹¦ API Key ç®¡ç†è¡¨æ ¼é…ç½®
FEISHU_PERSONAL_BASE_TOKEN=xxx
FEISHU_APIKEY_APP_TOKEN=xxx
FEISHU_APIKEY_TABLE_ID=xxx
FEISHU_API_BASE=https://base-api.feishu.cn

# é‡‡é›†é…ç½®
DEFAULT_MAX_NOTES=20
DEFAULT_USER_AGENT=Mozilla/5.0...
```

### 7.4 Coze å·¥ä½œæµé…ç½®

**éœ€è¦é…ç½®çš„å‚æ•°**:
1. FastAPI æœåŠ¡å™¨åœ°å€ï¼š`https://your-server.com`
2. é£ä¹¦ PersonalBaseTokenï¼šç”¨äºè°ƒç”¨é£ä¹¦æ‰¹é‡å†™å…¥ API

**é…ç½®æ–¹å¼**:
- æ–¹å¼ 1ï¼šåœ¨å¼€å§‹èŠ‚ç‚¹å¢åŠ  `personalBaseToken` å‚æ•°
- æ–¹å¼ 2ï¼šåœ¨ Coze ç¯å¢ƒå˜é‡ä¸­é…ç½®

---

## å…«ã€æµ‹è¯•è®¡åˆ’

### 8.1 å•å…ƒæµ‹è¯•

**æµ‹è¯•è¦†ç›–**:
- API Key éªŒè¯é€»è¾‘
- ç­¾åç”ŸæˆåŠŸèƒ½
- æ•°æ®æ ¼å¼è½¬æ¢
- é”™è¯¯å¤„ç†æœºåˆ¶

### 8.2 é›†æˆæµ‹è¯•

#### æµ‹è¯•ç”¨ä¾‹ 0: ç”¨æˆ·æä¾›çš„çœŸå®æ•°æ®ï¼ˆéœ€ç»´æŠ¤ï¼‰
æµ‹è¯•æ•°æ®ï¼š
apikeyï¼šP2025685459865471

cookiesï¼šad_worker_plugin_uuid=2c7bbacdd5404f969ae53ad7dd519c31; uuid=0947ba8d-9f63-466c-9668-9ab0a8b46c2b; gucci_worker_plugin_uuid=078b6df21b6a455f94597602fba8d7fc; a1=19925a5470187r8a44m356rcn47r2xy8vcwl4iiv530000598833; webId=1dab40285efc498992435fac4f5e90bf; gid=yjjJ2022J8hKyjjJ2024WS338yYWFY0446q2Eh2KFSI4W1q8FJCvY48882jYYqq824YDjYdi; abRequestId=1dab40285efc498992435fac4f5e90bf; customerClientId=316506318444956; x-user-id-ad.xiaohongshu.com=63f199ae000000001400ea9f; x-user-id-ad-market.xiaohongshu.com=63f199ae000000001400ea9f; access-token-ad-market.xiaohongshu.com=customer.ad_market.AT-68c517553927384459296772jkzr0p0psdudfgq0; omikuji_worker_plugin_uuid=2e5f7cbfc35749aca3cca4075e4a3018; service-market_worker_plugin_uuid=f713604713c64bae8bef1ba3dd755335; x-user-id-school.xiaohongshu.com=65d88e6a0000000005033c59; uuid=9a71ba65-8838-4175-b1a2-bb176bafd4b2; x-user-id-pro.xiaohongshu.com=63f199ae000000001400ea9f; x-user-id-pgy.xiaohongshu.com=65335fdf000000002b000d08; web_session=040069b4471c97fe5d5e9ee0683b4b620d3fcc; id_token=VjEAABu8PJsMQqUBtYgeibPEtT7USOHW9YaSADhLaGl6o698j2QPtHVnIByBEK06f+kWgehGdfTuED5Pbf9VX28bSW/FGhjCVXMPe280lpOtPGxHP46hVPtatjBIBSn1+7PtifE/; x-user-id-creator.xiaohongshu.com=65335fdf000000002b000d08; access-token-ark.beta.xiaohongshu.com=; access-token=; sso-type=customer; subsystem=ark; x-user-id-ark.xiaohongshu.com=65d88e6a0000000005033c59; access-token-ark.xiaohongshu.com=customer.ark.AT-68c517593546593749860358qvzwznboheiww9z3; beaker.session.id=7576da0fef8cfa45ec6bb47f9e7dafefbb7f9084gAJ9cQAoWAsAAABhcmstbGlhcy1pZHEBWBgAAAA2NjBhOWRlZjJmMjNlMTAwMDFmYWE5MTZxAlgOAAAAcmEtdXNlci1pZC1hcmtxA1gYAAAANjYwYTk3ZDllMjAwMDAwMDAwMDAwMDAzcQRYDgAAAF9jcmVhdGlvbl90aW1lcQVHQdpYbJmK8apYEQAAAHJhLWF1dGgtdG9rZW4tYXJrcQZYQQAAAGZhZTZjYTcxYzI4YjRiM2E4YTQ1ZWU4NzFkYjg0YzA5LTdjM2JmNzU4ZGI2MDRjMTM4ZGYyOWU3Njc1N2Q2NjAwcQdYAwAAAF9pZHEIWCAAAABlMGJjYmJhNjVmZGQ0NDVkOWJmNjE2Y2M1MGU1ZGM5ZHEJWA4AAABfYWNjZXNzZWRfdGltZXEKR0HaWGyZivGqdS4=; xsecappid=ugc; customer-sso-sid=68c517593993944658493441smi3lkvvhz0irv5b; access-token-creator.xiaohongshu.com=customer.creator.AT-68c517593993944658493442mtacitfe37qd2kxl; galaxy_creator_session_id=DcgesAYgN6KQ0B3Xkj7osDs0YoEiNCmHGGqI; galaxy.creator.beaker.session.id=1768114498630012615216; loadts=1768193857342; acw_tc=0a8f06de17681958331382236ec02086f6655c6d347414f77ab73daeed5817; acw_tc=0a00d58e17681958483181695e9813385749d5d2c2d5dad6427bba65da6398; websectiga=f47eda31ec99545da40c2f731f0630efd2b0959e1dd10d5fedac3dce0bd1e04d; sec_poison_id=765ab115-b773-434b-a0dd-a3be2dc01a3b

**è¯´æ˜**:
- è¿™äº›ç”¨ä¾‹ç”¨äºæœ¬åœ°è”è°ƒä¸å›å½’éªŒè¯ï¼Œé“¾æ¥ä¼šå¤±æ•ˆæ—¶éœ€æ›´æ–°ã€‚
- æ–°å¢/å˜æ›´ç”¨ä¾‹åï¼ŒåŒæ­¥æ›´æ–°éªŒè¯è„šæœ¬ä¸æ¥å£æµ‹è¯•æµç¨‹ã€‚

**å•ç¯‡ç¬”è®°é‡‡é›†**:
- å†™å…¥è¡¨æ ¼: `https://gcn6bvkburhk.feishu.cn/base/L5yObKSElaxLxUsmgM7cwR2unyd?table=tblwMX5d0foYrjLa&view=vewrPMnOOW`
- ç¬”è®°é“¾æ¥:
  - `https://www.xiaohongshu.com/explore/69510671000000001e011222?xsec_token=ABxT2P8uHqwH-TebtHvshWKszH_o0PEVe7mggVnW2Y2FU=&xsec_source=pc_feed`
  - `https://www.xiaohongshu.com/explore/6937c7f8000000001e038a42?xsec_token=ABNLxLp8ShdTiJRzGEvFvwCuJa2iOuhUG4DSOJtKtM_Qg=&xsec_source=pc_feed`
  - `https://www.xiaohongshu.com/explore/6957cfb10000000022033db9?xsec_token=AB_e-u3Bqk6Ppsm_ZAIk61DOnmby7IBlNn0kBy1Y1JsPQ=&xsec_source=pc_feed`

**åšä¸»ä¸»é¡µé‡‡é›†ï¼ˆå…¨éƒ¨ç¬”è®°ï¼‰**:
- å†™å…¥è¡¨æ ¼: `https://gcn6bvkburhk.feishu.cn/base/L5yObKSElaxLxUsmgM7cwR2unyd?table=tblwDly8JAMpzhmA&view=vewYP6e30Y`
- åšä¸»ä¸»é¡µé“¾æ¥:
  - `https://www.xiaohongshu.com/user/profile/67441cf7000000001c018939?xsec_token=ABFKZhDfqF7Pm5NYwEgAHA9tCTHni75uqEPCMPsYWpP8Q=&xsec_source=pc_note`

**åšä¸»ä¿¡æ¯é‡‡é›†**:
- å†™å…¥è¡¨æ ¼: `https://gcn6bvkburhk.feishu.cn/base/L5yObKSElaxLxUsmgM7cwR2unyd?table=tblBA6JLzTiH7s5r&view=vewYP6e30Y`
- åšä¸»ä¸»é¡µé“¾æ¥:
  - `https://www.xiaohongshu.com/user/profile/682fe78f000000000a03f922?xsec_token=ABzVOsPMtTLS9q2Juy508dv-WoSQCptR1jGUa5VgnEIEY=`

#### æµ‹è¯•ç”¨ä¾‹ 1: é‡‡é›† API ç‹¬ç«‹æµ‹è¯•

**è¯·æ±‚**:
```bash
curl -X POST https://your-server.com/api/v1/collect \
  -H "Content-Type: application/json" \
  -d '{
    "apiKey": "P2025685459865471",
    "cookie": "a1=xxx; ...",
    "bozhulianjie": "https://www.xiaohongshu.com/user/profile/xxx",
    "maxNotes": 5
  }'
```

**é¢„æœŸç»“æœ**:
- HTTP 200
- è¿”å› `success: true`
- `records` æ•°ç»„åŒ…å« 5 æ¡è®°å½•
- æ‰€æœ‰å­—æ®µç±»å‹æ­£ç¡®

#### æµ‹è¯•ç”¨ä¾‹ 2: é£ä¹¦å®˜æ–¹ API æµ‹è¯•

**è¯·æ±‚**:
```bash
curl -X POST "https://base-api.feishu.cn/open-apis/bitable/v1/apps/xxx/tables/xxx/records/batch_create" \
  -H "Authorization: Bearer {PersonalBaseToken}" \
  -H "Content-Type: application/json" \
  -d '{"records": [...]}'
```

**é¢„æœŸç»“æœ**:
- `code: 0`
- `msg: "success"`
- è¿”å›å†™å…¥çš„è®°å½•åˆ—è¡¨

#### æµ‹è¯•ç”¨ä¾‹ 3: Coze å·¥ä½œæµç«¯åˆ°ç«¯æµ‹è¯•

**æµç¨‹**:
1. è¾“å…¥å‚æ•°
2. è°ƒç”¨é‡‡é›† API â†’ è·å¾— records
3. æå–è¡¨æ ¼ä¿¡æ¯
4. è°ƒç”¨é£ä¹¦ API â†’ å†™å…¥æˆåŠŸ
5. è¿”å›æ±‡æ€»ç»“æœ

**éªŒè¯ç‚¹**:
- é‡‡é›†æˆåŠŸ
- é£ä¹¦å†™å…¥æˆåŠŸ
- å­—æ®µç±»å‹æ­£ç¡®ï¼ˆå¤šé€‰ã€æ•°å­—ã€æ—¥æœŸï¼‰
- å»¶è¿Ÿä¿æŠ¤ç”Ÿæ•ˆ

### 8.3 æ€§èƒ½æµ‹è¯•

**æŒ‡æ ‡**:
- å•æ¡ç¬”è®°å¤„ç†æ—¶é—´ï¼š5-10 ç§’
- 20 æ¡ç¬”è®°æ€»è€—æ—¶ï¼š< 180 ç§’
- API å“åº”æ—¶é—´ï¼š< 3 ç§’ï¼ˆä¸å«é‡‡é›†ï¼‰
- å¹¶å‘è¯·æ±‚ï¼šæ”¯æŒ 10 å¹¶å‘

---

## ä¹ã€ç›‘æ§å’Œè¿ç»´

### 9.1 æ—¥å¿—ç®¡ç†

**æ—¥å¿—çº§åˆ«**:
- INFOï¼šæ­£å¸¸è¯·æ±‚å’Œå“åº”
- WARNINGï¼šå»¶è¿Ÿä¿æŠ¤è§¦å‘
- ERRORï¼šé‡‡é›†å¤±è´¥ã€API é”™è¯¯

**æ—¥å¿—å†…å®¹**:
- API Key éªŒè¯ç»“æœ
- é‡‡é›†è¿›åº¦ï¼ˆx/totalï¼‰
- å¤±è´¥çš„ç¬”è®° ID
- é”™è¯¯è¯¦æƒ…

### 9.2 ç›‘æ§æŒ‡æ ‡

**å…³é”®æŒ‡æ ‡**:
- API è¯·æ±‚é‡ï¼ˆQPSï¼‰
- API Key éªŒè¯æˆåŠŸç‡
- é‡‡é›†æˆåŠŸç‡
- å¹³å‡å“åº”æ—¶é—´
- é”™è¯¯ç‡

### 9.3 å‘Šè­¦è§„åˆ™

**å‘Šè­¦æ¡ä»¶**:
- API Key éªŒè¯å¤±è´¥ç‡ > 10%
- é‡‡é›†æˆåŠŸç‡ < 80%
- é”™è¯¯ç‡ > 5%
- å“åº”æ—¶é—´ > 180 ç§’

---

## åã€é£é™©å’Œç¼“è§£æªæ–½

| é£é™©            | çº§åˆ«  | å½±å“        | ç¼“è§£æªæ–½                       |
| --------------- | :---: | ----------- | ------------------------------ |
| å°çº¢ä¹¦ API å˜æ›´ |  ä¸­   | é‡‡é›†å¤±è´¥    | ç›‘æ§é”™è¯¯ç‡ï¼ŒåŠæ—¶æ›´æ–°ç­¾åé€»è¾‘   |
| Cookie é¢‘ç¹å¤±æ•ˆ |  é«˜   | æ— æ³•é‡‡é›†    | æç¤ºç”¨æˆ·å®šæœŸæ›´æ–°ï¼Œå»ºè®®ä½¿ç”¨å°å· |
| é£ä¹¦ API é™æµ   |  ä½   | å†™å…¥å¤±è´¥    | ç›´æ¥ä½¿ç”¨å®˜æ–¹ APIï¼Œéµå®ˆé€Ÿç‡é™åˆ¶ |
| æœåŠ¡å™¨æ•…éšœ      |  ä¸­   | æœåŠ¡ä¸å¯ç”¨  | ä½¿ç”¨ Docker éƒ¨ç½²ï¼Œé…ç½®è‡ªåŠ¨é‡å¯ |
| åçˆ¬è™«å°ç¦      |  é«˜   | Cookie è¢«å° | å»¶è¿Ÿä¿æŠ¤ï¼Œé™åˆ¶é‡‡é›†é¢‘ç‡         |

---

## åä¸€ã€åç»­è§„åˆ’

### 11.1 åŠŸèƒ½æ‰©å±•

**è¿‘æœŸï¼ˆ1-3 ä¸ªæœˆï¼‰**:
- æ”¯æŒåˆ†é¡µé‡‡é›†ï¼ˆç¬¬ 2 é¡µåŠä»¥åï¼‰
- å¢åŠ è¯„è®ºæ•°æ®é‡‡é›†
- æ”¯æŒå¢é‡æ›´æ–°ï¼ˆåªé‡‡é›†æ–°ç¬”è®°ï¼‰

**ä¸­æœŸï¼ˆ3-6 ä¸ªæœˆï¼‰**:
- æ”¯æŒå¤šä¸ªåšä¸»æ‰¹é‡é‡‡é›†
- æ•°æ®å»é‡å’Œæ¸…æ´—
- å¯¼å‡ºä¸º CSV/Excel

**è¿œæœŸï¼ˆ6 ä¸ªæœˆä»¥ä¸Šï¼‰**:
- æ•°æ®å¯è§†åŒ–åˆ†æ
- è‡ªåŠ¨åŒ–æŠ¥å‘Šç”Ÿæˆ
- å†…å®¹è¶‹åŠ¿é¢„æµ‹

### 11.2 æ€§èƒ½ä¼˜åŒ–

- å¼•å…¥ç¼“å­˜æœºåˆ¶ï¼ˆRedisï¼‰
- æ”¯æŒå¼‚æ­¥æ‰¹é‡é‡‡é›†
- ä¼˜åŒ–ç­¾åç”Ÿæˆæ€§èƒ½

### 11.3 å®‰å…¨å¢å¼º

- API Key ä½¿ç”¨æ¬¡æ•°é™åˆ¶
- IP ç™½åå•
- åŠ å¯†å­˜å‚¨æ•æ„Ÿä¿¡æ¯

---

## åäºŒã€é™„å½•

### 12.1 æœ¯è¯­è¡¨

| æœ¯è¯­              | è¯´æ˜                           |
| ----------------- | ------------------------------ |
| FastAPI           | Python å¼‚æ­¥ Web æ¡†æ¶           |
| API Key           | å·¥ä½œæµè®¿é—®å¯†é’¥ï¼Œç”¨äºæƒé™éªŒè¯   |
| PersonalBaseToken | é£ä¹¦å¤šç»´è¡¨æ ¼ä¸ªäººè®¿é—®ä»¤ç‰Œ       |
| xhshow            | Python ç­¾åç”Ÿæˆåº“ï¼ˆå°çº¢ä¹¦ï¼‰    |
| Coze              | å­—èŠ‚è·³åŠ¨æ——ä¸‹çš„ AI åº”ç”¨å¼€å‘å¹³å° |
| feed API          | å°çº¢ä¹¦ç¬”è®°è¯¦æƒ… API             |
| Bitable           | é£ä¹¦å¤šç»´è¡¨æ ¼                   |

### 12.2 å‚è€ƒèµ„æ–™

1. **FastAPI å®˜æ–¹æ–‡æ¡£**: https://fastapi.tiangolo.com/
2. **é£ä¹¦å¤šç»´è¡¨æ ¼ API**: https://open.feishu.cn/document/docs/bitable-v1
3. **é£ä¹¦æ’ä»¶å¼€å‘æŒ‡å—**: è§é¡¹ç›®æ–‡ä»¶ `æ’ä»¶å¼€å‘æŒ‡å—.md`
4. **xhshow GitHub ä»“åº“**: https://github.com/Cloxl/xhshow
5. **Coze å®˜æ–¹æ–‡æ¡£**: https://www.coze.cn/open/docs/guides/code_node

### 12.3 è”ç³»æ–¹å¼

- æŠ€æœ¯æ”¯æŒ: -
- äº§å“åé¦ˆ: -
- æ–‡æ¡£ç»´æŠ¤: -

---

## æ–‡æ¡£å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ       | ä¿®æ”¹äºº | ä¿®æ”¹å†…å®¹                                                |
| ---- | ---------- | ------ | ------------------------------------------------------- |
| v1.0 | 2026-01-06 | -      | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäº FastAPI + Coze + é£ä¹¦å®˜æ–¹ API çš„æ··åˆæ¶æ„ |

---

**æ–‡æ¡£ç»“æŸ**
