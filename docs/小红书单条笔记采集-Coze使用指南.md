# 小红书单条笔记采集 - Coze 工作流使用指南

## 一、工作流概述

这是一个 **Coze 工作流模板**，用于采集单条小红书笔记的详细数据并写入飞书多维表格。

**核心优势**：
- ✅ 无需服务器，直接在 Coze 中运行
- ✅ 完全免费，无使用次数限制
- ✅ 自动签名生成，无需手动操作
- ✅ 直接写入飞书多维表格

## 二、工作流结构

```
开始节点（输入参数）
  ↓
代码节点：采集笔记数据
  ↓
飞书多维表格：新增记录
  ↓
结束节点（输出结果）
```

## 三、使用步骤

### 步骤 1：在 Coze 中创建工作流

1. 登录 [Coze 平台](https://www.coze.cn/)
2. 创建新工作流
3. 添加以下节点：
   - 开始节点
   - 代码节点
   - 飞书多维表格节点
   - 结束节点

### 步骤 2：配置开始节点（输入参数）

添加以下输入参数：

| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `bijilianjie` | 文本 | 是 | 小红书笔记链接 |
| `cookie` | 文本 | 是 | 小红书 Cookie |

**参数示例**：
- `bijilianjie`: `https://www.xiaohongshu.com/explore/676be3f9000000001b02e81b?xsec_token=xxx&xsec_source=pc_user`
- `cookie`: `a1=xxxxx; webId=xxxxx; web_session=xxxxx; ...`

### 步骤 3：配置代码节点

1. 在代码节点中选择 **Python** 语言
2. 复制 [coze_templates/xhs_single_note.py](../coze_templates/xhs_single_note.py) 的全部代码
3. 粘贴到代码节点中
4. 配置输入参数：
   - `bijilianjie`：连接到开始节点的 `bijilianjie`
   - `cookie`：连接到开始节点的 `cookie`
5. 配置输出：
   - 变量名：`records`
   - 类型：对象数组

### 步骤 4：配置飞书多维表格节点

1. 选择"批量新增记录"操作
2. 配置授权：使用 PersonalBaseToken（在飞书表格中获取）
3. 选择目标表格和表
4. 字段映射：
   - 数据源：选择代码节点输出的 `records`
   - 字段映射模式：自动映射

**飞书表格字段清单**：

| 字段名 | 字段类型 | 说明 |
|--------|---------|------|
| 笔记标题 | 文本 | 笔记标题 |
| 笔记内容 | 文本 | 笔记正文 |
| 笔记类型 | 单选 | video/normal |
| 笔记链接 | 文本 | 笔记URL |
| 笔记标签 | 多选 | 话题标签数组 |
| 账号名称 | 文本 | 博主昵称 |
| 主页链接 | 文本 | 博主主页 |
| 头像链接 | 文本 | 博主头像 |
| 图片链接 | 文本 | 图片URL（多张用换行分隔） |
| 笔记封面图链接 | 文本 | 封面图URL |
| 视频链接 | 文本 | 视频URL（仅视频笔记） |
| 点赞数 | 数字 | 点赞数 |
| 收藏数 | 数字 | 收藏数 |
| 评论数 | 数字 | 评论数 |
| 分享数 | 数字 | 分享数 |
| 发布时间 | 数字 | 时间戳（毫秒） |

### 步骤 5：配置结束节点

输出以下信息：
- `success`: 是否成功
- `message`: 执行结果描述

## 四、如何获取 Cookie

### 方法：浏览器开发者工具

1. 打开小红书网页版：https://www.xiaohongshu.com
2. 登录您的小红书账号
3. 按 F12 打开开发者工具
4. 切换到 **Network**（网络）标签
5. 刷新页面
6. 点击任意请求（例如第一个请求）
7. 在右侧找到 **Request Headers**
8. 复制 **Cookie** 的完整值

**Cookie 示例**：
```
a1=18e5bc24a25fdoabzuq05qvb41tpm8wslh8xtxbdm50000123456; webId=abc123def456; web_session=xxx; ...
```

**注意事项**：
- ⚠️ Cookie 通常 7-30 天失效，需定期更新
- ⚠️ 建议使用小号，避免主账号风险
- ⚠️ 不要在多个地方同时使用同一 Cookie

## 五、如何获取笔记链接

### 方法 1：从小红书 PC 端复制

1. 在小红书网页版打开笔记
2. 复制浏览器地址栏的完整 URL

**✅ 正确的链接格式**：
```
https://www.xiaohongshu.com/explore/676be3f9000000001b02e81b?xsec_token=AB5AkIhMixO5lfCdA8bT8JiC9wMMMGYQOQWaGT6DMMMM2wU=&xsec_source=pc_user
```

**❌ 错误的链接格式**：
```
https://www.xiaohongshu.com/explore/676be3f9000000001b02e81b
```
（缺少 `xsec_token` 参数，工作流会尝试从HTML中提取，可能失败）

### 方法 2：从小红书 App 分享

1. 在小红书 App 中打开笔记
2. 点击"分享"
3. 选择"复制链接"
4. 将短链接转换为完整链接（在浏览器中打开后复制）

## 六、运行工作流

1. 点击工作流的"运行"按钮
2. 输入笔记链接和 Cookie
3. 等待执行完成（通常 3-5 秒）
4. 查看飞书表格，确认数据已写入

## 七、常见问题

### Q1: 提示"Cookie 已失效"？

**原因**：Cookie 过期或被小红书服务器拒绝

**解决方案**：
1. 重新登录小红书网页版
2. 按照"如何获取 Cookie"步骤重新获取
3. 更新工作流中的 Cookie 参数

### Q2: 提示"笔记链接缺少 xsec_token"？

**原因**：笔记链接不完整

**解决方案**：
1. 确保链接包含 `?xsec_token=xxx` 参数
2. 或者直接在浏览器中打开笔记，复制完整 URL

### Q3: 飞书写入失败？

**原因**：
- 授权码错误
- 表格字段名称不匹配
- 字段类型不匹配

**解决方案**：
1. 检查 PersonalBaseToken 是否正确
2. 确认飞书表格字段名称与代码中的字段名完全一致
3. 检查字段类型：
   - 点赞数/收藏数/评论数/分享数 → **数字**
   - 笔记标签 → **多选**
   - 发布时间 → **数字**（毫秒时间戳）

### Q4: 代码执行报错？

**常见错误及解决方案**：

| 错误信息 | 原因 | 解决方案 |
|---------|------|----------|
| `Missing 'a1' in cookies` | Cookie 中缺少 a1 字段 | 确保复制了完整的 Cookie |
| `签名验证失败 (406)` | 签名算法问题 | 检查代码是否完整复制，或联系开发者 |
| `无法从 URL 中提取笔记 ID` | 笔记链接格式错误 | 使用正确的笔记链接格式 |

## 八、最佳实践

### 1. Cookie 管理
- ✅ 定期检查 Cookie 是否有效（建议每周检查一次）
- ✅ 准备多个小号，轮换使用
- ✅ 将 Cookie 保存在安全的地方（如密码管理器）

### 2. 采集频率控制
- ✅ 单条笔记采集间隔建议 **2-3 秒**
- ✅ 避免短时间内采集大量笔记
- ✅ 建议每天采集不超过 **50 条笔记**

### 3. 数据验证
- ✅ 采集后检查飞书表格数据是否完整
- ✅ 重点检查：点赞数、收藏数、笔记标签
- ✅ 如有数据缺失，可尝试重新采集

## 九、技术支持

如需帮助，请提供以下信息：
1. 错误截图或错误信息
2. 笔记链接示例（脱敏处理）
3. 飞书表格字段配置截图

---

**版本信息**：v1.0.0
**最后更新**：2026-01-12
**适用平台**：Coze 工作流
